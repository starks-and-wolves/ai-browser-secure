modules = ["nodejs-20"]

[nix]
channel = "stable-23_11"

# Use production mode by default to avoid dev-only CORS issues
[deployment]
run = ["npm", "start"]
deploymentTarget = "cloudrun"

[[ports]]
localPort = 3000
externalPort = 80

# Environment variables
[env]
NODE_ENV = "production"

# Disable UPM auto-install (prevent crashes)
[packager]
language = "nodejs-npm"
[packager.features]
packageSearch = false
guessImports = false
enabledForHosting = false
